
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<!DOCTYPE html>
<html lang="uk">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<head>
  <meta charset="UTF-8">
  <title>Калькулятор вантажів</title>
  <style>
    table, th, td { border: 1px solid black; border-collapse: collapse; padding: 5px; }
body {
  font-family: Arial, sans-serif;
  background: #f5f7fa;
  margin: 20px;
}

button {
  background: #4CAF50;
  color: white;
  border: none;
  padding: 6px 12px;
  margin: 2px;
  border-radius: 4px;
  cursor: pointer;
  transition: 0.3s;
}
button:hover {
  background: #45a049;
}

#dimensionsTable {
  border-collapse: collapse;
  width: 100%;
  margin-top: 10px;
}
#dimensionsTable th, #dimensionsTable td {
  border: 1px solid #ddd;
  padding: 8px;
}
#dimensionsTable tr:nth-child(even) {
  background-color: #f9f9f9;
}
#dimensionsTable tr:hover {
  background-color: #f1f1f1;
}
#dimensionsTable th {
  background-color: #4CAF50;
  color: white;
}

#editModal {
  display: none;
  position: fixed;
  top: 20%;
  left: 30%;
  background: #fff;
  border: 2px solid #4CAF50;
  padding: 20px;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  z-index: 1000;
  animation: fadeIn 0.3s;
}
@keyframes fadeIn {
  from {opacity: 0;}
  to {opacity: 1;}
}

#searchName {
  padding: 6px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

/* Загальний контейнер */
.container {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
}

/* Блок калькулятора */
.calculator {
  flex: 1 1 300px;
  background: #fff;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 0 8px rgba(0,0,0,0.1);
}

/* Таблиця словника */
#dimensionsTable {
  width: 100%;
  border-collapse: collapse;
}
#dimensionsTable th, #dimensionsTable td {
  padding: 8px;
  border: 1px solid #ddd;
}

/* Кнопки */
button {
  width: auto;
  min-width: 120px;
  margin: 4px 0;
}

/* Поля вводу */
input, select {
  width: 100%;
  max-width: 250px;
  padding: 6px;
  margin: 4px 0;
  border: 1px solid #ccc;
  border-radius: 4px;
}

/* Адаптивність */
@media (max-width: 768px) {
  .container {
    flex-direction: column;
  }
  #dimensionsTable th, #dimensionsTable td {
    font-size: 14px;
  }
  button {
    width: 100%;
  }
}  

</style>
</head>
<body>
  <h2>Калькулятор вантажів</h2>

  <!-- Довідник найменувань -->
  <label>Найменування:
    <select id="name">
      <option value="Цегла">Цегла</option>
      <option value="Дошки">Дошки</option>
    </select>
  </label>
  <input type="text" id="newName" placeholder="Нове найменування">
  <button onclick="addName()"><i class="fa fa-plus"></i> Додати в довідник</button>
  <button onclick="removeName()"><i class="fa fa-trash"></i> Видалити з довідника</button>
  <br><br>

<h3>Перелік найменувань в довіднику</h3>
<table id="dimensionsTable">
  <tr>
    <th>Найменування</th>
    <th>Форма упаковки</th>
    <th>Габарити упаковки</th>
    <th>Одиниці</th>
    <th>Видалення/Редагування 
         позиції</th>    
  </tr>
</table>
<button onclick="renderDimensions()">Оновити список</button> 

<!-- Модальне вікно -->
<div id="editModal" style="display:none; position:fixed; top:20%; left:30%; background:#fff; border:1px solid #000; padding:20px;">
  <h3>Редагування розмірів</h3>
  <label>Форма:
    <select id="editShape">
      <option value="box">Коробка</option>
      <option value="cylinder">Циліндр</option>
      <option value="sphere">Сфера</option>
      <option value="cone">Конус</option>
    </select>
  </label><br>
  <label>Одиниці:
    <select id="editUnit">
      <option value="m">м</option>
      <option value="cm">см</option>
      <option value="mm">мм</option>
    </select>
  </label><br>
  <div id="editInputs"></div>
  <button onclick="saveEditedDimensions()">Зберегти</button>
  <button onclick="closeEditModal()">Закрити</button>
</div>

<h3>Експорт/Імпорт довідник</h3>
<button onclick="exportDimensions()">Експорт файлу</button>
<input type="file" id="importFile" accept=".json" onchange="importDimensions(event)">

 <!-- Тип вантажу -->
  <label>Тип вантажу:
    <select id="shape">
      <option value="box">Коробка</option>
      <option value="cylinder">Циліндр</option>
      <option value="sphere">Сфера</option>
      <option value="cone">Конус</option>
    </select>
  </label><br>

  <!-- Одиниці -->
  <label>Одиниці:
    <select id="unit">
      <option value="cm">см</option>
      <option value="m">м</option>
      <option value="mm">мм</option>
    </select>
  </label><br>
  <label>Параметри пакування:
  <!-- Динамічні поля -->
  <div id="inputs"></div>

  <!-- Параметри -->
  <label>К-ть в упаковці: <input type="number" id="packCount"></label><br>
  <label>К-ть майна якого треба отримати шт: <input type="number" id="need"></label><br>

  <button onclick="addRow()">Додати у таблицю</button>
  <button onclick="exportXLSX()">Експортувати у XLSX</button>

  <!-- Таблиця -->
  <table id="cargoTable">
    <tr>
      <th>Найменування</th><th>Тип пакування</th><th>Розміри упаковки</th>
      <th>Об'єм одного пакування (м³)</th><th>К-ть в упаковці (шт)</th>
      <th>К-ть майна якого треба отримати (шт)</th><th>К-ть упаковок для отримання (шт)</th>
      <th>Загальний об’єм (м³)</th><th>Дія</th>
    </tr>
    <tr id="summaryRow">
  <td colspan="5" style="text-align:right"><b>Разом:</b></td>
  <td id="grandNeed">0</td> <!-- нова клітинка для "Треба отримати" -->
  <td id="grandUnits">0</td>
  <td id="grandTotal">0</td>
  <td></td>
</tr>

<script>
// --- LocalStorage для розмірів ---
let itemDimensions = JSON.parse(localStorage.getItem("itemDimensions")) || {};

function saveItemDimensions() {
  localStorage.setItem("itemDimensions", JSON.stringify(itemDimensions));
}

function showInputs() {
  const shape = document.getElementById("shape").value;
  let html="";
  if (shape==="box") html='Довжина:<input id="length" type="number"> Ширина:<input id="width" type="number"> Висота:<input id="height" type="number">';
  else if (shape==="cylinder") html='Радіус:<input id="radius" type="number"> Висота:<input id="height" type="number">';
  else if (shape==="sphere") html='Радіус:<input id="radius" type="number">';
  else if (shape==="cone") html='Радіус:<input id="radius" type="number"> Висота:<input id="height" type="number">';
  document.getElementById("inputs").innerHTML=html;
}

function convertToMeters(v,u){ if(u==="cm") return v/100; if(u==="mm") return v/1000; return v; }

function calculateVolume(shape,unit){
  let V=0;
  if(shape==="box"){ let l=convertToMeters(parseFloat(document.getElementById("length").value),unit);
    let w=convertToMeters(parseFloat(document.getElementById("width").value),unit);
    let h=convertToMeters(parseFloat(document.getElementById("height").value),unit); V=l*w*h; }
  else if(shape==="cylinder"){ let r=convertToMeters(parseFloat(document.getElementById("radius").value),unit);
    let h=convertToMeters(parseFloat(document.getElementById("height").value),unit); V=Math.PI*r*r*h; }
  else if(shape==="sphere"){ let r=convertToMeters(parseFloat(document.getElementById("radius").value),unit); V=(4/3)*Math.PI*Math.pow(r,3); }
  else if(shape==="cone"){ let r=convertToMeters(parseFloat(document.getElementById("radius").value),unit);
    let h=convertToMeters(parseFloat(document.getElementById("height").value),unit); V=(1/3)*Math.PI*r*r*h; }
  return V;
}

function addRow(){
  const name=document.getElementById("name").value;
  const shape=document.getElementById("shape").value;
  const unit=document.getElementById("unit").value;
  const packCount=parseFloat(document.getElementById("packCount").value);
  const need=parseFloat(document.getElementById("need").value);
  const V=calculateVolume(shape,unit);
  if(isNaN(packCount)||isNaN(need)||isNaN(V)){ alert("Заповніть усі поля!"); return; }

// --- Автоматичне збереження розмірів ---
if (!itemDimensions[name]) {
  if (shape === "box") {
    itemDimensions[name] = {
      shape: "box",
      length: parseFloat(document.getElementById("length").value),
      width: parseFloat(document.getElementById("width").value),
      height: parseFloat(document.getElementById("height").value),
      unit: unit
    };
  } else if (shape === "cylinder" || shape === "cone") {
    itemDimensions[name] = {
      shape: shape,
      radius: parseFloat(document.getElementById("radius").value),
      height: parseFloat(document.getElementById("height").value),
      unit: unit
    };
  } else if (shape === "sphere") {
    itemDimensions[name] = {
      shape: "sphere",
      radius: parseFloat(document.getElementById("radius").value),
      unit: unit
    };
  }
  saveItemDimensions(); // зберегти у LocalStorage
}  

const units=need/packCount; const totalVolume=units*V;
  let dimensions="";
  if(shape==="box") dimensions=`Д:${document.getElementById("length").value}${unit}, Ш:${document.getElementById("width").value}${unit}, В:${document.getElementById("height").value}${unit}`;
  else if(shape==="cylinder"||shape==="cone") dimensions=`R:${document.getElementById("radius").value}${unit}, H:${document.getElementById("height").value}${unit}`;
  else if(shape==="sphere") dimensions=`R:${document.getElementById("radius").value}${unit}`;
  const table=document.getElementById("cargoTable");
  const row=table.insertRow(table.rows.length-1);
  

// словник для відображення українських назв
  const shapeNames = {
    box: "Коробка",
    cylinder: "Циліндр",
    sphere: "Сфера",
    cone: "Конус"
  };

  row.insertCell(0).innerText=name; row.insertCell(1).innerText=shapeNames[shape]; // тут буде «Коробка» замість "box"
 row.insertCell(2).innerText=dimensions;
  row.insertCell(3).innerText=V.toFixed(4); row.insertCell(4).innerText=packCount; row.insertCell(5).innerText=need;
  row.insertCell(6).innerText=units.toFixed(2); row.insertCell(7).innerText=totalVolume.toFixed(4);
  const del=row.insertCell(8); const btn=document.createElement("button"); btn.innerText="Видалити"; btn.onclick=function(){deleteRow(this);}; del.appendChild(btn);
  updateGrandTotal();
  document.getElementById("packCount").value=""; document.getElementById("need").value="";
  if(shape==="box"){document.getElementById("length").value="";document.getElementById("width").value="";document.getElementById("height").value="";}
  else if(shape==="cylinder"||shape==="cone"){document.getElementById("radius").value="";document.getElementById("height").value="";}
  else if(shape==="sphere"){document.getElementById("radius").value="";}
}

function deleteRow(btn){ const row=btn.parentNode.parentNode; row.parentNode.removeChild(row); updateGrandTotal(); }

function updateGrandTotal() {
  const table = document.getElementById("cargoTable");
  let sumNeed = 0;
  let sumUnits = 0;
  let sumVolume = 0;

  for (let i = 1; i < table.rows.length - 1; i++) {
    sumNeed += parseFloat(table.rows[i].cells[5].innerText);   // колонка "Треба отримати"
    sumUnits += parseFloat(table.rows[i].cells[6].innerText);  // колонка "к-ть одиниць"
    sumVolume += parseFloat(table.rows[i].cells[7].innerText); // колонка "Об’єм загальний"
  }

  document.getElementById("grandNeed").innerText = sumNeed.toFixed(0);
  document.getElementById("grandUnits").innerText = sumUnits.toFixed(2);
  document.getElementById("grandTotal").innerText = sumVolume.toFixed(4);
}
function addName() {
  const newName = document.getElementById("newName").value.trim();
  if (newName) {
    const sel = document.getElementById("name");
    const opt = document.createElement("option");
    opt.value = newName;
    opt.text = newName;
    sel.add(opt);
    sel.value = newName;
    document.getElementById("newName").value = "";
  }
}

function renderDimensions() {
  const table = document.getElementById("dimensionsTable");

  // очистити всі рядки крім заголовка
  while (table.rows.length > 1) {
    table.deleteRow(1);
  }

  for (const [name, dims] of Object.entries(itemDimensions)) {
    const row = table.insertRow();

    // Найменування
    row.insertCell(0).innerText = name;

    // Форма
    row.insertCell(1).innerText = dims.shape;

    // Розміри
    let dimText = "";
    if (dims.shape === "box") {
      dimText = `Д:${dims.length}, Ш:${dims.width}, В:${dims.height}`;
    } else if (dims.shape === "cylinder" || dims.shape === "cone") {
      dimText = `R:${dims.radius}, H:${dims.height}`;
    } else if (dims.shape === "sphere") {
      dimText = `R:${dims.radius}`;
    }
    row.insertCell(2).innerText = dimText;

    // Одиниці
    row.insertCell(3).innerText = dims.unit;
    
   // Кнопка видалення
    const delCell = row.insertCell(4);
    const btn = document.createElement("button");
    btn.innerText = "Видалити";
    btn.onclick = function() {
      delete itemDimensions[name];
      saveItemDimensions();
      renderDimensions(); // оновити таблицю
    };
    delCell.appendChild(btn);

// Кнопка редагування
const editBtn = document.createElement("button");
editBtn.innerText = "Редагувати";
editBtn.onclick = function() {
  editDimensions(name);
};
row.insertCell(5).appendChild(editBtn);
  }
}

function editDimensions(name) {
  const dims = itemDimensions[name];
  if (!dims) return;

  // Відкрити форму редагування
  let newShape = prompt("Форма (box, cylinder, sphere, cone):", dims.shape);
  let newUnit = prompt("Одиниці (m, cm, mm):", dims.unit);

  if (newShape === "box") {
    dims.length = parseFloat(prompt("Довжина:", dims.length));
    dims.width = parseFloat(prompt("Ширина:", dims.width));
    dims.height = parseFloat(prompt("Висота:", dims.height));
  } else if (newShape === "cylinder" || newShape === "cone") {
    dims.radius = parseFloat(prompt("Радіус:", dims.radius));
    dims.height = parseFloat(prompt("Висота:", dims.height));
  } else if (newShape === "sphere") {
    dims.radius = parseFloat(prompt("Радіус:", dims.radius));
  }

  dims.shape = newShape;
  dims.unit = newUnit;

  // Зберегти зміни
  itemDimensions[name] = dims;
  saveItemDimensions();
  renderDimensions(); // оновити таблицю
}

function exportXLSX() {
  updateGrandTotal(); // оновити підсумки перед експортом
  const table = document.getElementById("cargoTable");
  let data = [];

  // беремо всі рядки крім останнього (summaryRow)
  for (let i = 0; i < table.rows.length - 1; i++) {
    let row = [], cols = table.rows[i].cells;
    for (let j = 0; j < cols.length; j++) {
      row.push(cols[j].innerText.replace(/\./g, ",")); // крапки → коми
    }
    data.push(row);
  }

  // додаємо підсумки окремим рядком (9 колонок!)
  data.push([
    "", "", "", "", "Разом:", 
    document.getElementById("grandNeed").innerText.replace(/\./g, ","), 
    document.getElementById("grandUnits").innerText.replace(/\./g, ","), 
    document.getElementById("grandTotal").innerText.replace(/\./g, ","), 
    ""
  ]);

  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.aoa_to_sheet(data);
  XLSX.utils.book_append_sheet(wb, ws, "Вантажі");
  XLSX.writeFile(wb, "cargo_table.xlsx");
}

// --- LocalStorage для найменувань ---
function loadNames() {
  const saved = JSON.parse(localStorage.getItem("names")) || ["Цегла", "Дошки"];
  const sel = document.getElementById("name");
  sel.innerHTML = ""; // очистити список
  saved.forEach(n => {
    const opt = document.createElement("option");
    opt.value = n;
    opt.text = n;
    sel.add(opt);
  });
}

function saveNames() {
  const sel = document.getElementById("name");
  let names = [];
  for (let i = 0; i < sel.options.length; i++) {
    names.push(sel.options[i].value);
  }
  localStorage.setItem("names", JSON.stringify(names));
}

// --- Автозаповнення при виборі найменування ---
document.getElementById("name").addEventListener("change", function() {
  const selected = this.value;
  if (itemDimensions[selected]) {
    const dims = itemDimensions[selected];
    document.getElementById("shape").value = dims.shape;
    document.getElementById("unit").value = dims.unit;
    showInputs(); // оновити поля відповідно до форми

    if (dims.shape === "box") {
      document.getElementById("length").value = dims.length;
      document.getElementById("width").value = dims.width;
      document.getElementById("height").value = dims.height;
    } else if (dims.shape === "cylinder" || dims.shape === "cone") {
      document.getElementById("radius").value = dims.radius;
      document.getElementById("height").value = dims.height;
    } else if (dims.shape === "sphere") {
      document.getElementById("radius").value = dims.radius;
    }
  }
});

function addName() {
  const newName = document.getElementById("newName").value.trim();
  if (newName) {
    const sel = document.getElementById("name");
    const opt = document.createElement("option");
    opt.value = newName;
    opt.text = newName;
    sel.add(opt);
    sel.value = newName;
    document.getElementById("newName").value = "";
    saveNames(); // зберегти у LocalStorage
  }
}

function removeName() {
  const sel = document.getElementById("name");
  if (sel.selectedIndex > -1) {
    const removedName = sel.options[sel.selectedIndex].value;

    // Видаляємо саму назву зі списку
    sel.remove(sel.selectedIndex);
    saveNames();

    // --- Видаляємо розміри для цього найменування ---
    if (itemDimensions[removedName]) {
      delete itemDimensions[removedName];
      saveItemDimensions(); // оновлюємо LocalStorage
    }
  }
}
// --- Виклик при завантаженні сторінки ---
loadNames();

// Показати поля при зміні типу вантажу
document.getElementById("shape").addEventListener("change", showInputs);

let currentEditName = null;

function renderDimensions() {
  const table = document.getElementById("dimensionsTable");
  while (table.rows.length > 1) table.deleteRow(1);

  for (const [name, dims] of Object.entries(itemDimensions)) {
    const row = table.insertRow();
    row.insertCell(0).innerText = name;
    row.insertCell(1).innerText = dims.shape;

    let dimText = "";
    if (dims.shape === "box") dimText = `Д:${dims.length}, Ш:${dims.width}, В:${dims.height}`;
    else if (dims.shape === "cylinder" || dims.shape === "cone") dimText = `R:${dims.radius}, H:${dims.height}`;
    else if (dims.shape === "sphere") dimText = `R:${dims.radius}`;
    row.insertCell(2).innerText = dimText;

    row.insertCell(3).innerText = dims.unit;

    const actions = row.insertCell(4);
    const delBtn = document.createElement("button");
    delBtn.innerHTML = '<i class="fa fa-trash"></i> Видалити';
    delBtn.onclick = function() {
      delete itemDimensions[name];
      saveItemDimensions();
      renderDimensions();
    };
    actions.appendChild(delBtn);

    const editBtn = document.createElement("button");
    editBtn.innerHTML = '<i class="fa fa-pencil-alt"></i> Редагувати';
    editBtn.onclick = function() {
      editDimensions(name);
    };
    actions.appendChild(editBtn);
  }
}

function editDimensions(name) {
  currentEditName = name;
  const dims = itemDimensions[name];
  if (!dims) return;

  document.getElementById("editShape").value = dims.shape;
  document.getElementById("editUnit").value = dims.unit;
  showEditInputs(dims);

  document.getElementById("editModal").style.display = "block";
}

function showEditInputs(dims) {
  let html = "";
  if (dims.shape === "box") {
    html = `Довжина:<input id="editLength" type="number" value="${dims.length}">
            Ширина:<input id="editWidth" type="number" value="${dims.width}">
            Висота:<input id="editHeight" type="number" value="${dims.height}">`;
  } else if (dims.shape === "cylinder" || dims.shape === "cone") {
    html = `Радіус:<input id="editRadius" type="number" value="${dims.radius}">
            Висота:<input id="editHeight" type="number" value="${dims.height}">`;
  } else if (dims.shape === "sphere") {
    html = `Радіус:<input id="editRadius" type="number" value="${dims.radius}">`;
  }
  document.getElementById("editInputs").innerHTML = html;
}

function saveEditedDimensions() {
  const dims = itemDimensions[currentEditName];
  dims.shape = document.getElementById("editShape").value;
  dims.unit = document.getElementById("editUnit").value;

  if (dims.shape === "box") {
    dims.length = parseFloat(document.getElementById("editLength").value);
    dims.width = parseFloat(document.getElementById("editWidth").value);
    dims.height = parseFloat(document.getElementById("editHeight").value);
  } else if (dims.shape === "cylinder" || dims.shape === "cone") {
    dims.radius = parseFloat(document.getElementById("editRadius").value);
    dims.height = parseFloat(document.getElementById("editHeight").value);
  } else if (dims.shape === "sphere") {
    dims.radius = parseFloat(document.getElementById("editRadius").value);
  }

  itemDimensions[currentEditName] = dims;
  saveItemDimensions();
  renderDimensions();
  closeEditModal();
}

function closeEditModal() {
  document.getElementById("editModal").style.display = "none";
}

function exportDimensions() {
  const dataStr = JSON.stringify(itemDimensions, null, 2); // красиво форматований JSON
  const blob = new Blob([dataStr], { type: "application/json" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "itemDimensions.json";
  a.click();

  URL.revokeObjectURL(url);
}

function importDimensions(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const imported = JSON.parse(e.target.result);
      if (typeof imported === "object") {
        itemDimensions = imported;
        saveItemDimensions();

        // --- Оновлюємо список найменувань ---
        const names = Object.keys(itemDimensions);
        localStorage.setItem("names", JSON.stringify(names));
        loadNames(); // оновити <select id="name">

        renderDimensions(); // оновити таблицю словника
        alert("Словник успішно імпортовано!");
      } else {
        alert("Невірний формат JSON.");
      }
    } catch (err) {
      alert("Помилка при імпорті: " + err.message);
    }
  };
  reader.readAsText(file);
}
// Показати поля одразу при завантаженні сторінки
showInputs();
</script>
</body>
</html>